<html>
<head>
<base href="https://websim.ai/"></head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulario Web</title>
<style>
  body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 20px;
    background-color: #f4f4f4;
  }
  .container {
    max-width: 800px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  h1, h2 {
    color: #333;
  }
  .group {
    margin-bottom: 20px;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 5px;
  }
  label {
    display: block;
    margin-bottom: 5px;
  }
  input[type="text"], input[type="password"], textarea {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
  .file-upload {
    margin-bottom: 10px;
  }
  button {
    background-color: #4CAF50;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  button:hover {
    background-color: #45a049;
  }
  .hidden {
    display: none;
  }
</style>
</head>
<body>
 <div class="container">
  <h1>Acta de Reunion</h1>
  <form id="loginForm">
    <label for="email">Usuario / Email:</label>
    <input type="text" id="email" name="email" required>

    <label for="password">Contraseña:</label>
    <input type="password" id="password" name="password" required>

    <button type="submit">Ingresar</button>
  </form>
</div>

<div class="container hidden" id="formContainer">
  <h1>Formulario Web</h1>
  <form id="webSimForm">
    <div class="group">
      <h2>Titulo 1</h2>
      <label for="titulo1">Actividad</label>
      <input type="text" id="titulo1" name="titulo1" required>
      
      <label for="descripcion1">Observaciones:</label>
      <textarea id="descripcion1" name="descripcion1" rows="3" required></textarea>
      
      <label for="subir1">Subir archivos 1 (máximo 5):</label>
      <input type="file" id="subir1" name="subir1" multiple accept="*" class="file-upload">
    </div>

    <div class="group">
      <h2>Titulo 2</h2>
      <label for="titulo2">Actividad</label>
      <input type="text" id="titulo2" name="titulo2" required>
      
      <label for="descripcion2">Observaciones 2:</label>
      <textarea id="descripcion2" name="descripcion2" rows="3" required></textarea>
      
      <label for="subir2">Subir archivos 2 (máximo 5):</label>
      <input type="file" id="subir2" name="subir2" multiple accept="*" class="file-upload">
    </div>

    <div class="group">
      <h2>Titulo 3</h2>
      <label for="titulo3">Actividad</label>
      <input type="text" id="titulo3" name="titulo3" required>
      
      <label for="descripcion3">Observaciones</label>
      <textarea id="descripcion3" name="descripcion3" rows="3" required></textarea>
      
      <label for="subir3">Subir archivos 3 (máximo 5):</label>
      <input type="file" id="subir3" name="subir3" multiple accept="*" class="file-upload">
    </div>

    <div class="group">
      <h2>Titulo 4</h2>
      <label for="titulo4">Actividad</label>
      <input type="text" id="titulo4" name="titulo4" required>
      
      <label for="descripcion4">Observaciones</label>
      <textarea id="descripcion4" name="descripcion4" rows="3" required></textarea>
      
      <label for="subir4">Subir archivos 4 (máximo 5):</label>
      <input type="file" id="subir4" name="subir4" multiple accept="*" class="file-upload">
    </div>

    <button type="submit" id="submitBtn">Enviar Acta</button>
  </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('loginForm');
    const formContainer = document.getElementById('formContainer');
    const webSimForm = document.getElementById('webSimForm');
    const fileInputs = document.querySelectorAll('input[type="file"]');

 

   // Función de validación de usuario
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      if (email === 'edgar.visurraga@sacmigroup.com' && password === '1234' || email === 'veronica.centelles@sacmigroup.com' && password === '1234' || email === 'andrea.delhoyo@sacmigroup.com' && password === '1234') {
        loginForm.classList.add('hidden');
        formContainer.classList.remove('hidden');
      } else {
        alert('Usuario o contraseña incorrecto');
      }
    });



    fileInputs.forEach(input => {
      input.addEventListener('change', function() {
        if (this.files.length > 5) {
          alert('Por favor, seleccione un máximo de 5 archivos.');
          this.value = '';
        }
      });
    });


    
webSimForm.addEventListener('submit', async function (e) {
  e.preventDefault();

  if (confirm('¿Está seguro de que desea enviar el formulario?')) {
    alert('Formulario enviado con éxito. Se descargará una copia en PDF.');

    const { jsPDF } = window.jspdf;
    const margin = 42.52; // 1.5 cm ≈ 42.52 puntos
    const headerHeight = 72; // 2.5 cm ≈ 72 puntos para el encabezado
    const imgWidth = 80; // Ancho de las imágenes en el PDF
    const imgHeight = 60; // Alto de las imágenes en el PDF
    const imgSpacing = 28.35; // 1 cm ≈ 28.35 puntos, espacio entre imágenes
    const bottomMargin = 28.35; // Margen inferior de 1 cm

    const doc = new jsPDF({
      unit: 'pt',
      format: 'a4',
      orientation: 'portrait'
    });

    const pageWidth = doc.internal.pageSize.getWidth();
    const pageHeight = doc.internal.pageSize.getHeight();
    let yOffset = margin + headerHeight; // Comenzamos después del encabezado

    // Función para agregar el encabezado
    const addHeader = (doc) => {
      // Logo
      doc.addImage('url_de_tu_logo', 'JPEG', margin, margin, 99.21, 72); // 3,5 cm x 2,5 cm

      // Título centrado
      doc.setFontSize(16);
      doc.text('ACTA DE CONFORMIDAD', pageWidth / 2, margin + 36, { align: 'center' });

      // Fecha en el lado derecho
      const currentDate = new Date().toLocaleDateString();
      doc.setFontSize(12);
      doc.text(currentDate, pageWidth - margin, margin + 36, { align: 'right' });
    };

    // Función para agregar el contenido del formulario al PDF
    const addContent = (title, content) => {
      yOffset += 42.52; // Añadir 1,5 cm antes de cada título

      doc.setFontSize(14);
      doc.text(title, margin, yOffset);
      yOffset += 20;

      doc.setFontSize(12);
      doc.text(content, margin, yOffset, { maxWidth: pageWidth - 2 * margin });
      yOffset += doc.getTextDimensions(content).h + 14;

      // Si el contenido se desborda la página, agregar una nueva
      if (yOffset > pageHeight - bottomMargin) {
        doc.addPage();
        addHeader(doc);
        yOffset = margin + headerHeight;
      }
    };

    const loadImage = (file) => {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function (event) {
          const img = new Image();
          img.onload = function () {
            resolve(img);
          };
          img.src = event.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    };

    // Añadir el encabezado en la primera página
    addHeader(doc);

    for (let i = 1; i <= 4; i++) {
      addContent(`Título ${i}:`, document.getElementById(`titulo${i}`).value);
      addContent(`Descripción ${i}:`, document.getElementById(`descripcion${i}`).value);

      const fileInput = document.getElementById(`subir${i}`);
      if (fileInput.files.length > 0) {
        doc.text(`Archivos subidos ${i}:`, margin, yOffset);
        yOffset += 20;

        let imgXOffset = margin;
        let imgYOffset = yOffset;

        for (let file of fileInput.files) {
          if (file.type.startsWith('image/')) {
            try {
              const img = await loadImage(file);

              // Insertar la imagen en la posición actual
              doc.addImage(img, 'JPEG', imgXOffset, imgYOffset, imgWidth, imgHeight);
              imgXOffset += imgWidth + imgSpacing; // Añadir 1 cm de espacio entre imágenes

              // Verificar si el ancho actual supera el máximo permitido
              if (imgXOffset + imgWidth + margin > pageWidth) {
                imgXOffset = margin;
                imgYOffset += imgHeight + imgSpacing; // Añadir espacio entre filas de imágenes
              }

              // Si el contenido se desborda la página, agregar una nueva
              if (imgYOffset + imgHeight + bottomMargin > pageHeight - 42.52) {
                doc.addPage();
                addHeader(doc);
                imgXOffset = margin;
                imgYOffset = margin + headerHeight;
              }
            } catch (error) {
              console.error('Error al cargar la imagen:', error);
            }
          } else {
            doc.text(file.name, imgXOffset, imgYOffset + imgHeight + 10); // Colocar el nombre debajo de la imagen
            imgXOffset += imgWidth + imgSpacing;

            if (imgXOffset + imgWidth + margin > pageWidth) {
              imgXOffset = margin;
              imgYOffset += imgHeight + imgSpacing + 20; // Aumentar espacio si hay más nombres de archivos
            }
          }
        }

        // Actualizar yOffset después de procesar las imágenes
        yOffset = imgYOffset + imgHeight + 20;

        // Si el contenido se desborda, agregar una nueva página
        if (yOffset > pageHeight - bottomMargin) {
          doc.addPage();
          addHeader(doc);
          yOffset = margin + headerHeight;
        }
      }
    }

    // Guardar el PDF en local
    doc.save('acta_reunion.pdf');

    // Enviar el correo electrónico con el número del acta
    const actaNumero = document.getElementById('titulo1').value;

    emailjs.send('service_dajtsaj', 'template_rbxc814', {
      to_name: 'edgar.visurraga@sacmigroup.com',
      from_name: 'edgar.visurraga@sacmigroup.com',
      message: `Se ha firmado el acta número ${actaNumero}.`,
    }).then(function (response) {
      console.log('Correo enviado con éxito', response.status, response.text);
      alert('Correo enviado con éxito.');
    }, function (error) {
      console.error('Error al enviar el correo:', error);
      alert('Hubo un error al enviar el correo.');
    });
  }
});





  });
</script>

<script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script type="text/javascript">
  (function(){
    emailjs.init("HuYjsFfgTlc0LX8bV"); // Reemplaza "edgar_services_id" con tu ID de usuario de EmailJS
  })();
</script>

</body>
</html>
